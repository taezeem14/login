<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PhysiFormz - Physics Formula Finder</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0f172a;
      color: #f8fafc;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }
    .app {
      text-align: center;
      background: #1e293b;
      padding: 2rem;
      border-radius: 1.5rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
      max-width: 500px;
      width: 90%;
    }
    input, button {
      padding: 0.7rem;
      border-radius: 0.5rem;
      border: none;
      margin-top: 1rem;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background: #0ea5e9;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .btns {
      display: flex;
      gap: 10px;
      margin-top: 1rem;
    }
    #resultCard {
      margin-top: 2rem;
      text-align: left;
      background: #334155;
      padding: 1rem;
      border-radius: 1rem;
    }
    .desc {
      color: #94a3b8;
      font-size: 0.98em;
      margin-top: 3px;
      margin-bottom: 15px;
    }
    a {
      color: #0ea5e9;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    .suggestion {
      background: #fbbf24;
      color: #1e293b;
      padding: 4px 10px;
      border-radius: 6px;
      cursor: pointer;
      margin-left: 8px;
      font-weight: bold;
    }
    .latex {
      margin: 0.4em 0;
      background: #0f172a;
      padding: 4px 8px;
      border-radius: 8px;
      display: inline-block;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .loader {
      border: 4px solid #334155;
      border-top: 4px solid #38bdf8;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      animation: spin 1s linear infinite;
      margin: 1rem auto;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>‚öõÔ∏è PhysiFormz</h1>
    <input type="text" id="searchInput" placeholder="Enter physics topic (e.g. Pressure)" />
    <div class="btns">
      <button id="searchBtn">Search</button>
      <button id="voiceBtn">üé§</button>
    </div>
    <div id="resultCard"></div>
  </div>

  <script>
    const WOLFRAM_APP_ID = "8GWUHU49QA";

    const formulaDB = {
      "pressure": [{ name: "Pressure", formula: "P = \\frac{F}{A}", description: "Pressure (P) is the force (F) applied per unit area (A)." }],
      "momentum": [{ name: "Momentum", formula: "p = m v", description: "Momentum (p) is the product of mass (m) and velocity (v); it is a vector quantity." }],
      "taylor series": [{ name: "Taylor Series Expansion", formula: "f(x) = f(a) + f'(a)(x‚àía) + \\frac{f''(a)}{2!}(x‚àía)^2 + \\dots", description: "Expands a function f(x) in terms of its derivatives at point a." }],
      "ohm's law": [{ name: "Ohm's Law", formula: "V = I R", description: "Voltage (V) equals current (I) times resistance (R)." }],
      "newton's second law": [{ name: "Newton's Second Law", formula: "F = m a", description: "Force (F) equals mass (m) times acceleration (a)." }],
      "gravitational force": [{ name: "Newton's Law of Gravitation", formula: "F = G \\frac{m_1 m_2}{r^2}", description: "Force (F) between masses m‚ÇÅ and m‚ÇÇ separated by distance r, with gravitational constant G." }],
      "snell's law": [{ name: "Snell's Law", formula: "n_1 \\sin\\theta_1 = n_2 \\sin\\theta_2", description: "Describes refraction of light between two media with refractive indices n‚ÇÅ and n‚ÇÇ." }],
      "kinematics": [
        { name: "First Equation of Motion", formula: "v = u + a t", description: "Final velocity (v) after time (t) for acceleration (a) from initial velocity (u)." },
        { name: "Second Equation of Motion", formula: "s = u t + \\frac{1}{2} a t^2", description: "Displacement (s) after time (t) for acceleration (a) from initial velocity (u)." },
        { name: "Third Equation of Motion", formula: "v^2 = u^2 + 2 a s", description: "Relates velocities, acceleration, and displacement." }
      ]
    };

    function levenshtein(a, b) {
      const matrix = Array(a.length + 1).fill(null).map(() => Array(b.length + 1).fill(null));
      for (let i = 0; i <= a.length; i++) matrix[i][0] = i;
      for (let j = 0; j <= b.length; j++) matrix[0][j] = j;
      for (let i = 1; i <= a.length; i++) {
        for (let j = 1; j <= b.length; j++) {
          const cost = a[i - 1] === b[j - 1] ? 0 : 1;
          matrix[i][j] = Math.min(matrix[i - 1][j] + 1, matrix[i][j - 1] + 1, matrix[i - 1][j - 1] + cost);
        }
      }
      return matrix[a.length][b.length];
    }

    function getClosestTopic(input) {
      input = input.toLowerCase();
      let minDist = Infinity;
      let suggestion = null;
      for (const topic of Object.keys(formulaDB)) {
        const dist = levenshtein(input, topic);
        if (dist < minDist) {
          minDist = dist;
          suggestion = topic;
        }
      }
      if ((input.length <= 6 && minDist <= 2) || (input.length > 6 && minDist <= 3)) {
        return suggestion;
      }
      return null;
    }

    async function fetchWolframShortAnswer(query) {
      const url = `https://api.wolframalpha.com/v1/result?i=${encodeURIComponent(query)}&appid=${WOLFRAM_APP_ID}`;
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("No answer");
        return await res.text();
      } catch {
        return null;
      }
    }

    async function fetchWikipediaSummary(query) {
      try {
        const res = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
        const data = await res.json();
        if (data.extract) {
          return { title: data.title, extract: data.extract, url: `https://en.wikipedia.org/wiki/${encodeURIComponent(query)}` };
        }
      } catch {
        return null;
      }
    }

    const searchBtn = document.getElementById('searchBtn');
    const resultCard = document.getElementById('resultCard');
    const searchInput = document.getElementById('searchInput');
    const voiceBtn = document.getElementById('voiceBtn');

    searchBtn.addEventListener('click', async () => {
      let topicRaw = searchInput.value.trim();
      if (!topicRaw) return alert('Enter a topic first, dawg üß†');
      let topic = topicRaw.toLowerCase();

      const closest = getClosestTopic(topic);
      if (closest && closest !== topic) {
        resultCard.innerHTML = `<p>Did you mean: <span class="suggestion" id="spellingSuggest">${closest}</span>?</p>`;
        document.getElementById('spellingSuggest').onclick = () => {
          searchInput.value = closest;
          searchBtn.click();
        };
        return;
      }

      resultCard.innerHTML = `<div class="loader"></div><p>Loading formulaz & explanation...‚è≥</p>`;

      const wolframAnswer = await fetchWolframShortAnswer(topicRaw);
      const wiki = await fetchWikipediaSummary(topicRaw);

      let formulaHtml = "", explanationHtml = "";

      if (formulaDB[topic]) {
        formulaHtml = `<h2>Formula${formulaDB[topic].length > 1 ? "s" : ""} for ${topicRaw}</h2>` +
          formulaDB[topic].map((f, i) =>
            `<div><b>${f.name}</b>: <div class="latex" id="latex${i}"></div><div class="desc">${f.description}</div></div>`
          ).join("<hr>");
      }

      if (wolframAnswer && !wolframAnswer.toLowerCase().includes('no short answer')) {
        explanationHtml = `<h3>Explanation (Wolfram)</h3><div class="desc">${wolframAnswer}</div>
          <a href="https://www.wolframalpha.com/input/?i=${encodeURIComponent(topicRaw)}" target="_blank">See on WolframAlpha ‚û§</a>`;
      } else if (wiki) {
        explanationHtml = `<h3>What is "${wiki.title}"?</h3><div class="desc">${wiki.extract}</div>
          <a href="${wiki.url}" target="_blank">Wikipedia ‚û§</a>`;
      }

      if (!formulaHtml && !explanationHtml) {
        resultCard.innerHTML = `<p>No formula or explanation found for '${topicRaw}' üòî</p>`;
      } else {
        resultCard.innerHTML = formulaHtml + explanationHtml;
        // Render LaTeX
        if (formulaDB[topic]) {
          formulaDB[topic].forEach((f, i) => {
            katex.render(f.formula, document.getElementById(`latex${i}`), { throwOnError: false });
          });
        }
      }
    });

    searchInput.addEventListener('keydown', e => { if (e.key === "Enter") searchBtn.click(); });

    voiceBtn.onclick = () => {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) return alert("Voice search not supported üòî");
      const recog = new SpeechRecognition();
      recog.lang = "en-US";
      recog.start();
      recog.onresult = e => {
        searchInput.value = e.results[0][0].transcript;
        searchBtn.click();
      };
    };
  </script>
</body>
</html>
